<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê°•ë‚¨êµ¬ ê³ ë„ ì§€ë„ | Gangnam-gu Elevation Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
#map { width: 100%; height: 100vh; }

.control-panel {
  position: absolute;
  top: 10px;
  left: 50px;
  z-index: 1000;
  background: rgba(255,255,255,0.96);
  border-radius: 10px;
  padding: 10px 14px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.15);
  font-size: 13px;
  max-width: 220px;
}
.control-panel h3 { font-size: 15px; margin-bottom: 6px; }
.control-panel label {
  display: flex;
  align-items: center;
  gap: 5px;
  margin-bottom: 3px;
  cursor: pointer;
  font-size: 12.5px;
}
.control-panel hr { border: none; border-top: 1px solid #eee; margin: 6px 0; }

.elevation-bar {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1000;
  background: rgba(0,0,0,0.82);
  color: #fff;
  border-radius: 20px;
  padding: 8px 20px;
  font-size: 14px;
  font-weight: 500;
  display: none;
  white-space: nowrap;
  backdrop-filter: blur(6px);
}

.my-location-btn {
  position: absolute;
  bottom: 70px;
  right: 12px;
  z-index: 1000;
  width: 42px;
  height: 42px;
  border-radius: 50%;
  background: #fff;
  border: none;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  cursor: pointer;
  font-size: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s;
}
.my-location-btn:hover { background: #f0f0f0; }
.my-location-btn:active { background: #e0e0e0; }

.legend {
  position: absolute;
  bottom: 20px;
  right: 12px;
  z-index: 1000;
  background: rgba(255,255,255,0.96);
  border-radius: 8px;
  padding: 8px 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.12);
  font-size: 11px;
}
.legend h4 { font-size: 12px; margin-bottom: 4px; }
.legend-item { display: flex; align-items: center; margin-bottom: 2px; }
.legend-color {
  width: 18px; height: 10px; border-radius: 2px;
  margin-right: 5px; border: 1px solid rgba(0,0,0,0.08);
}

/* Station label styling */
.station-label {
  background: rgba(255,255,255,0.92);
  border: 1.5px solid;
  border-radius: 4px;
  padding: 1px 5px;
  font-size: 11px;
  font-weight: 600;
  white-space: nowrap;
  box-shadow: 0 1px 3px rgba(0,0,0,0.15);
  line-height: 1.4;
}
.line-2 { border-color: #33A23D; color: #33A23D; }
.line-3 { border-color: #FE5B10; color: #FE5B10; }
.line-7 { border-color: #6E8B2D; color: #6E8B2D; }
.line-9 { border-color: #AA9872; color: #AA9872; }
.line-sh { border-color: #A71E31; color: #A71E31; }
.line-bx { border-color: #7C4A2F; color: #7C4A2F; }
.line-su { border-color: #FFD400; color: #b39500; }

.hill-label {
  font-size: 11px;
  font-weight: 700;
  color: #8B4513;
  text-shadow: 0 0 3px #fff, 0 0 3px #fff, 0 0 3px #fff;
  white-space: nowrap;
}

/* Pulse animation for current location */
@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(66,133,244,0.5); }
  70% { box-shadow: 0 0 0 15px rgba(66,133,244,0); }
  100% { box-shadow: 0 0 0 0 rgba(66,133,244,0); }
}
.loc-pulse {
  width: 16px; height: 16px;
  background: #4285F4;
  border: 3px solid #fff;
  border-radius: 50%;
  box-shadow: 0 0 0 0 rgba(66,133,244,0.5);
  animation: pulse 2s infinite;
}
</style>
</head>
<body>

<div id="map"></div>

<div class="control-panel">
  <h3>ğŸ”ï¸ ê°•ë‚¨êµ¬ ê³ ë„ ì§€ë„</h3>
  <hr>
  <label><input type="radio" name="base" value="topo" checked> ë“±ê³ ì„  ì§€í˜•ë„</label>
  <label><input type="radio" name="base" value="osm"> ì¼ë°˜ ì§€ë„</label>
  <label><input type="radio" name="base" value="satellite"> ìœ„ì„± ì§€ë„</label>
  <hr>
  <label><input type="checkbox" id="hillshade" checked> ìŒì˜ê¸°ë³µ</label>
  <label><input type="checkbox" id="stations" checked> ğŸš‡ ì§€í•˜ì² ì—­</label>
  <label><input type="checkbox" id="markers" checked> â›°ï¸ ì£¼ìš” ì–¸ë•</label>
</div>

<button class="my-location-btn" id="locateBtn" title="ë‚´ ìœ„ì¹˜">ğŸ“</button>

<div class="elevation-bar" id="elevationDisplay"></div>

<div class="legend">
  <h4>ê³ ë„</h4>
  <div class="legend-item"><div class="legend-color" style="background:#1a9850"></div>0~20m</div>
  <div class="legend-item"><div class="legend-color" style="background:#91cf60"></div>20~40m</div>
  <div class="legend-item"><div class="legend-color" style="background:#fee08b"></div>40~80m</div>
  <div class="legend-item"><div class="legend-color" style="background:#fc8d59"></div>80~150m</div>
  <div class="legend-item"><div class="legend-color" style="background:#d73027"></div>150m+</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const gangnamCenter = [37.497, 127.047];
const gangnamBounds = [[37.464, 127.012], [37.532, 127.105]];

// --- Base Layers ---
const topoLayer = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
  maxZoom: 17, attribution: 'Â© OpenTopoMap'
});
const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19, attribution: 'Â© OSM'
});
const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
  maxZoom: 18, attribution: 'Â© Esri'
});
const hillshadeLayer = L.tileLayer('https://tiles.wmflabs.org/hillshading/{z}/{x}/{y}.png', {
  maxZoom: 17, opacity: 0.4
});

// --- Map ---
const map = L.map('map', {
  center: gangnamCenter,
  zoom: 14,
  layers: [topoLayer, hillshadeLayer],
  zoomControl: true
});
map.fitBounds(gangnamBounds, { padding: [10, 10] });

// --- Subway Stations in/near Gangnam-gu ---
const stations = [
  // Line 2 (green)
  { name: 'ê°•ë‚¨', lat: 37.4979, lng: 127.0276, line: '2', cls: 'line-2' },
  { name: 'ì—­ì‚¼', lat: 37.5007, lng: 127.0366, line: '2', cls: 'line-2' },
  { name: 'ì„ ë¦‰', lat: 37.5045, lng: 127.0490, line: '2', cls: 'line-2' },
  { name: 'ì‚¼ì„±', lat: 37.5088, lng: 127.0639, line: '2', cls: 'line-2' },
  { name: 'ì¢…í•©ìš´ë™ì¥', lat: 37.5107, lng: 127.0736, line: '2', cls: 'line-2' },
  { name: 'ì ì‹¤ìƒˆë‚´', lat: 37.5116, lng: 127.0862, line: '2', cls: 'line-2' },
  { name: 'êµëŒ€', lat: 37.4934, lng: 127.0146, line: '2', cls: 'line-2' },
  // Line 3 (orange)
  { name: 'ì••êµ¬ì •', lat: 37.5270, lng: 127.0286, line: '3', cls: 'line-3' },
  { name: 'ì‹ ì‚¬', lat: 37.5164, lng: 127.0203, line: '3', cls: 'line-3' },
  { name: 'ì ì›', lat: 37.5112, lng: 127.0155, line: '3', cls: 'line-3' },
  { name: 'ë§¤ë´‰', lat: 37.4874, lng: 127.0347, line: '3', cls: 'line-3' },
  { name: 'ë„ê³¡', lat: 37.4915, lng: 127.0455, line: '3', cls: 'line-3' },
  { name: 'ëŒ€ì¹˜', lat: 37.4948, lng: 127.0577, line: '3', cls: 'line-3' },
  { name: 'í•™ì—¬ìš¸', lat: 37.4965, lng: 127.0648, line: '3', cls: 'line-3' },
  { name: 'ëŒ€ì²­', lat: 37.4920, lng: 127.0744, line: '3', cls: 'line-3' },
  { name: 'ì¼ì›', lat: 37.4836, lng: 127.0867, line: '3', cls: 'line-3' },
  { name: 'ìˆ˜ì„œ', lat: 37.4872, lng: 127.1017, line: '3', cls: 'line-3' },
  // Line 7 (olive)
  { name: 'ê°•ë‚¨êµ¬ì²­', lat: 37.5173, lng: 127.0413, line: '7', cls: 'line-7' },
  { name: 'ì²­ë‹´', lat: 37.5196, lng: 127.0539, line: '7', cls: 'line-7' },
  { name: 'ë…¼í˜„', lat: 37.5113, lng: 127.0215, line: '7', cls: 'line-7' },
  { name: 'í•™ë™', lat: 37.5146, lng: 127.0319, line: '7', cls: 'line-7' },
  // Line 9 (gold)
  { name: 'ë´‰ì€ì‚¬', lat: 37.5140, lng: 127.0580, line: '9', cls: 'line-9' },
  { name: 'ì‚¼ì„±ì¤‘ì•™', lat: 37.5107, lng: 127.0660, line: '9', cls: 'line-9' },
  { name: 'ì„ ì •ë¦‰', lat: 37.5104, lng: 127.0448, line: '9', cls: 'line-9' },
  { name: 'ì–¸ì£¼', lat: 37.5072, lng: 127.0340, line: '9', cls: 'line-9' },
  { name: 'ì‹ ë…¼í˜„', lat: 37.5045, lng: 127.0253, line: '9', cls: 'line-9' },
  // Shinbundang (red)
  { name: 'ì‹ ì‚¬(ì‹ ë¶„ë‹¹)', lat: 37.5164, lng: 127.0203, line: 'ì‹ ë¶„ë‹¹', cls: 'line-sh' },
  { name: 'ê°•ë‚¨(ì‹ ë¶„ë‹¹)', lat: 37.4965, lng: 127.0284, line: 'ì‹ ë¶„ë‹¹', cls: 'line-sh' },
  { name: 'ì–‘ì¬', lat: 37.4842, lng: 127.0352, line: 'ì‹ ë¶„ë‹¹', cls: 'line-sh' },
  // Bundang (yellow)
  { name: 'ì„ ë¦‰(ë¶„ë‹¹)', lat: 37.5045, lng: 127.0490, line: 'ë¶„ë‹¹', cls: 'line-su' },
  { name: 'í•œí‹°', lat: 37.4984, lng: 127.0561, line: 'ë¶„ë‹¹', cls: 'line-su' },
  { name: 'ë„ê³¡(ë¶„ë‹¹)', lat: 37.4915, lng: 127.0455, line: 'ë¶„ë‹¹', cls: 'line-su' },
  { name: 'êµ¬ë£¡', lat: 37.4847, lng: 127.0538, line: 'ë¶„ë‹¹', cls: 'line-su' },
  { name: 'ê°œí¬ë™', lat: 37.4787, lng: 127.0549, line: 'ë¶„ë‹¹', cls: 'line-su' },
  { name: 'ëŒ€ëª¨ì‚°ì…êµ¬', lat: 37.4765, lng: 127.0772, line: 'ë¶„ë‹¹', cls: 'line-su' },
  // SRT
  { name: 'ìˆ˜ì„œ(SRT)', lat: 37.4872, lng: 127.1017, line: 'SRT', cls: 'line-bx' },
];

// Deduplicate stations at same location â€” show combined label
const stationMap = new Map();
stations.forEach(s => {
  const key = `${s.lat.toFixed(3)},${s.lng.toFixed(3)}`;
  if (!stationMap.has(key)) stationMap.set(key, s);
});

const stationGroup = L.layerGroup();
stationMap.forEach(s => {
  const icon = L.divIcon({
    html: `<div class="station-label ${s.cls}">ğŸš‡ ${s.name}</div>`,
    className: '',
    iconSize: null,
    iconAnchor: [0, 0]
  });
  L.marker([s.lat, s.lng], { icon, interactive: false }).addTo(stationGroup);
});
stationGroup.addTo(map);

// --- Hills ---
const hills = [
  { name: 'ëŒ€ëª¨ì‚° 293m', lat: 37.4730, lng: 127.0830 },
  { name: 'êµ¬ë£¡ì‚° 306m', lat: 37.4785, lng: 127.0620 },
  { name: 'ë§¤ë´‰ì‚° 101m', lat: 37.4910, lng: 127.0450 },
  { name: 'ìš°ë©´ì‚° 293m', lat: 37.4780, lng: 127.0080 },
  { name: 'ì„¸ê³¡ë™ êµ¬ë¦‰ ~120m', lat: 37.4680, lng: 127.0700 },
  { name: 'ì¼ì›ë™ êµ¬ë¦‰ ~80m', lat: 37.4830, lng: 127.0900 },
];

const hillGroup = L.layerGroup();
hills.forEach(h => {
  const icon = L.divIcon({
    html: `<div class="hill-label">â›°ï¸ ${h.name}</div>`,
    className: '',
    iconSize: null,
    iconAnchor: [0, 8]
  });
  L.marker([h.lat, h.lng], { icon }).addTo(hillGroup);
});
hillGroup.addTo(map);

// --- Layer Controls ---
const baseLayers = { topo: topoLayer, osm: osmLayer, satellite: satelliteLayer };
let currentBase = 'topo';

document.querySelectorAll('input[name="base"]').forEach(r => {
  r.addEventListener('change', e => {
    map.removeLayer(baseLayers[currentBase]);
    currentBase = e.target.value;
    map.addLayer(baseLayers[currentBase]);
  });
});

document.getElementById('hillshade').addEventListener('change', e => {
  e.target.checked ? map.addLayer(hillshadeLayer) : map.removeLayer(hillshadeLayer);
});
document.getElementById('stations').addEventListener('change', e => {
  e.target.checked ? map.addLayer(stationGroup) : map.removeLayer(stationGroup);
});
document.getElementById('markers').addEventListener('change', e => {
  e.target.checked ? map.addLayer(hillGroup) : map.removeLayer(hillGroup);
});

// --- Click Elevation ---
const elevDisplay = document.getElementById('elevationDisplay');
let elevMarker = null;

map.on('click', async (e) => {
  const { lat, lng } = e.latlng;
  elevDisplay.style.display = 'block';
  elevDisplay.textContent = 'â³ ê³ ë„ ì¡°íšŒ ì¤‘...';

  if (elevMarker) map.removeLayer(elevMarker);
  elevMarker = L.circleMarker([lat, lng], {
    radius: 5, color: '#e74c3c', fillColor: '#e74c3c', fillOpacity: 0.9, weight: 2
  }).addTo(map);

  try {
    const res = await fetch(`https://api.open-elevation.com/api/v1/lookup?locations=${lat},${lng}`);
    const data = await res.json();
    const elev = data.results[0].elevation;
    elevDisplay.textContent = `ğŸ“ ê³ ë„ ${elev}m  (${lat.toFixed(4)}, ${lng.toFixed(4)})`;
  } catch {
    elevDisplay.textContent = `ğŸ“ ê³ ë„ ì¡°íšŒ ì‹¤íŒ¨ â€” ë‹¤ì‹œ í´ë¦­í•´ë³´ì„¸ìš”`;
  }
});

// --- My Location ---
let locMarker = null;
let locCircle = null;

document.getElementById('locateBtn').addEventListener('click', () => {
  if (!navigator.geolocation) {
    alert('ì´ ë¸Œë¼ìš°ì €ì—ì„œ ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
    return;
  }
  const btn = document.getElementById('locateBtn');
  btn.textContent = 'â³';

  navigator.geolocation.getCurrentPosition(pos => {
    const { latitude: lat, longitude: lng, accuracy } = pos.coords;

    if (locMarker) { map.removeLayer(locMarker); map.removeLayer(locCircle); }

    const locIcon = L.divIcon({
      html: '<div class="loc-pulse"></div>',
      className: '',
      iconSize: [16, 16],
      iconAnchor: [8, 8]
    });

    locMarker = L.marker([lat, lng], { icon: locIcon, zIndexOffset: 9999 })
      .bindPopup(`ğŸ“ ë‚´ ìœ„ì¹˜<br>${lat.toFixed(5)}, ${lng.toFixed(5)}`)
      .addTo(map)
      .openPopup();

    locCircle = L.circle([lat, lng], {
      radius: accuracy,
      color: '#4285F4',
      fillColor: '#4285F4',
      fillOpacity: 0.1,
      weight: 1
    }).addTo(map);

    map.setView([lat, lng], 15);
    btn.textContent = 'ğŸ“';

    // Also fetch elevation
    fetch(`https://api.open-elevation.com/api/v1/lookup?locations=${lat},${lng}`)
      .then(r => r.json())
      .then(d => {
        const elev = d.results[0].elevation;
        elevDisplay.style.display = 'block';
        elevDisplay.textContent = `ğŸ“ ë‚´ ìœ„ì¹˜ ê³ ë„: ${elev}m`;
        locMarker.setPopupContent(`ğŸ“ ë‚´ ìœ„ì¹˜ â€” ê³ ë„ ${elev}m<br>${lat.toFixed(5)}, ${lng.toFixed(5)}`);
      })
      .catch(() => {});
  }, err => {
    btn.textContent = 'ğŸ“';
    alert('ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + err.message);
  }, { enableHighAccuracy: true, timeout: 10000 });
});
</script>
</body>
</html>
